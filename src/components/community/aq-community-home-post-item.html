<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel='import' href='../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html'>
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/iron-icons/maps-icons.html">
<link rel='import' href='../profile-img.html'>

<dom-module id="aq-community-home-post-item">
  <style is="custom-style" include="iron-flex iron-positioning iron-flex-alignment"></style>

  <style>
    .post-container {
      width: 70%;
      border-bottom: 1px solid #e5e5e5;--#80CBC4;--#666;
      margin-top: 10px;
      padding-bottom: 5px;
      margin-bottom: 30px;
    }

    #top-section {
      height:40px;
    }

    #bottom-section {
      --height:20px;
    }

    #date {
      color: #444;
    }
    #author-name {
      color: teal;
    }

    #left-section {
      --width: 100%;
    }

    #right-section {
      --min-width: 300px;
    }

    a {
      text-decoration: none;
    }

    span {
      font-size: 12px;
    }

    profile-img {
      margin:auto 0;
      margin-right: 10px;
      margin-bottom: 2px;
      --width:20px;
    }

    #total-replies {
      min-width: 70px;
      margin-right: 10px;
    }

    #total-views {
      min-width: 50px;
      margin-right: 10px;
    }

    #category {
      min-width: 150px;
    }

  </style>
  <template>
  	<div class="post-container layout horizontal">
      <profile-img letter="[[getInitials(authorFirstname, authorLastname)]]"></profile-img>
      <div>
	        <div on-tap='onView'><a href$="[[topicAddress]]">[[topicHeading]]</a></div>
          <a href$="[[authoraddress]]">
            <span id="author-name">[[authorFirstname]] [[authorLastname]]</span>
          </a>
          <span id="date">   on [[postDate]]</span>
      </div>

      <div class="flex"></div>
      <div id='right-section' class="layout horizontal self-end">
        <div id="total-replies"><span>Replies: [[totalReplies]]</span></div>
        <div id="total-views"><span>Views: [[totalViews]]</span></div>
        <div id='category'><span>Category: [[postCategory]]</span></div>
      </div>
    </div>

    <iron-ajax
      url="http://localhost:3002/api/v2/thread/[[itemId]]/view"
      method="POST"
      id='views'
      handle-as="json"
      headers='{{header}}'
      debounce-duration="300">
    </iron-ajax>

  </template>

  <script>
    Polymer ({
      is: 'aq-community-home-post-item',
      properties: {
        topicAddress: String,
        topicHeading: String,
        authorFirstname: String,
        authorLastname: String,
        authorAddress: String,
        postDate: String,
        totalReplies: String,
        totalViews: String,
        postCategory: String,
        itemId:String,
      },

      listeners:{
        'follow-action':'onFollow',
      },

      ready: function() {
          var x = localStorage.getItem('my-app-storage');
          var user = JSON.parse(x).user;
          this.header = {
              "aimsquant-token": user.token,
              "Content-Type": "application/json"
          };
      },

      getInitials(firstName, lastName) {
        return firstName.charAt(0) + lastName.charAt(0);
      },

      onView() {
        this.$.views.generateRequest();
      },

    });
  </script>

</dom-module>
