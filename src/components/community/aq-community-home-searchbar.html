<link rel='import' href='../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html'>
<link rel='import' href='../../../bower_components/paper-radio-group/paper-radio-group.html'>
<link rel='import' href='../../../bower_components/paper-radio-button/paper-radio-button.html'>
<link rel='import' href='../../../bower_components/paper-tooltip/paper-tooltip.html'>

<link rel='import' href='../common/aq-check-authentication.html'>
<dom-module id='aq-community-home-searchbar'>
    <style include="iron-flex iron-flex-alignment iron-positioning">
    </style>

    <style>

        #searchbox, #searchbox1 {
            height: 32px;
            -webkit-appearance: none;
            line-height: 46px;
            border: 0;
            margin: 0;
            padding-left: 30px;
            border: 1px solid #e5e5e5;
            @apply(--paper-font-body1);
            font-size: 14px;
            background-color: #fff;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.4s ease-in-out;
            display: inline-block;
        }

        #searchbox:focus, #searchbox1:focus {
            outline: 0;
            background-color: #f7f7f7;
        }

        #searchbox::-webkit-search-cancel-button, #searchbox1::-webkit-search-cancel-button {
            position: relative;
            right: 15px;
        }

        .search-bar {
            width: 45%;
            margin: 0 auto;
            /*display: flex;*/
            /*align-items: center;*/
            position: relative;
        }

        paper-button {
            border: none;
        }

        .upper-container {
            margin-bottom: 20px;
            width: 100%;
        }

        .search-btn {
            border: none;
            font-size: 13px;
            background-color: teal;
            color: #fff;
            padding: 0 20px;
            border-radius: 2px;
            height: 35px;
        }

    </style>

    <template>
        <aq-check-authentication id='authItem'></aq-check-authentication>
        <div class="upper-container layout horizontal wrap">
            <div class="search-bar layout horizontal center-justified">
                <input id="searchbox" placeholder="Search Term" class="flex"
                       value="{{searchValue::input}}"
                       on-keydown="checkForKeys" on-blur='blur'>
            </div>
            <div class="search-bar layout horizontal center-justified">
                <input id="searchbox1" placeholder="Tags" class="flex"
                       value="{{searchText::change}}"
                       on-keydown="checkForKeys" on-blur='blur'>
            </div>
            <paper-button raised class="btn search-btn" on-tap="search">Search</paper-button>
        </div>
    </template>
    <script>

        Polymer({
            is: 'aq-community-home-searchbar',

            properties: {
                selectedCategory: {
                    type: Number,
                    value: 0,
                },

                searchValue: {
                    type: String,
                    value: "",
                },

                lastSearchValue: {
                    type: String,
                    value: "",
                },

                lastSelectedCategory: {
                    type: Number,
                    value: 0,
                },

                active: Boolean,

                categories: {
                    type: Array,
                    value: [{value: "All", index: 0}, {
                        value: "Share your Idea",
                        index: 1
                    }, {value: "Questions and Answers", index: 2}, {value: "News and Announcements", index: 3}],

                },
            },

            attached: function () {
                if (this.active) {
                    this.$.searchdiv.style.display = 'block';
                    this.$.searchIcon.style.display = 'none';
                    this.$.searchbox.focus();
                    this.$.searchbox.value = this.searchValue;
                }
            },

            search: function () {
                this.searchValue = this.$$('#searchbox').value;

                if (this.lastSelectedCategory != this.selectedCategory || this.lastSearchValue != this.searchValue) {

                    this.fire('search-action', {
                        text: this.searchValue,
                        category: this.selectedCategory >= 0 ? this.categories[this.selectedCategory].value : ""
                    });
                }

//                if (this.searchValue == "") {
//                    this.toggle();
//                }

                this.lastSearchValue = this.searchValue;
                this.lastSelectedCategory = this.selectedCategory;

            },

            toggle: function () {
                var d = this.$.searchdiv.style.display;
                if (d == "block") {
                    this.$.searchdiv.style.display = 'none';
                    this.$.searchIcon.style.display = 'inline';
                } else {

                    if (!this.$.authItem.checkHasToken()) {
                        this.fire('rt-changed', {route: '/user/signin'});
                        return;
                    }
                    this.$.searchdiv.style.display = 'block';
                    this.$.searchIcon.style.display = 'none';
                    this.$.searchbox.focus();
                    this.$.searchbox.value = "";
                }
            },

            /*blur: function(e) {
             if(this.$$('#searchbox').value=="") {
             //this.$$('#searchdiv').style.display = 'none';
             //this.$$('#searchIcon').style.display = 'inline';
             console.log("in blur");
             this.search();
             }
             },*/

            checkForKeys: function (e) {
                // check if 'esc' was pressed
                if (e.keyCode === 27) {
                    this.$$('#searchbox').value = "";
                    this.selectedCategory = 0;
                    this.search();
                } else if (e.keyCode === 13) {
                    this.search();
                }
            },

        });


    </script>
</dom-module>

