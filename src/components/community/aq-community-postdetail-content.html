<link rel='import' href='../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html'>
<link rel="import" href="../help/aq-help-marked-item.html">
<link rel="import" href="../common/aq-backtest-detail-item.html">
<link rel="import" href="../profile-img.html">

<dom-module id="aq-community-postdetail-content">
   
    <style  include="iron-flex iron-flex-alignment iron-positioning">
    </style>
   
   <style>
    :host {
      display:block;
    }

    #author {
      --margin-top:40px;
      --margin-bottom: 15px;
      border-bottom: 1px solid teal;--#bfbfbf;
    }

    #img {
      margin-right:10px;
      margin-bottom: 5px;
    }

    #author-desc {
      margin-bottom: 5px;
    }

    #post-content {
      margin-bottom:50px;
    }

    .markdown-html {
      border: 1px solid #efefef;

      --margin-left: 5px;
      padding-left: 5px;
      margin-top:5px;
      font-size: 15px;
      min-height: 50px;
      --max-height: 350px;
      overflow: auto;
    }

    i {
      font-size: 12px;
    }

  </style>

  <template>
    <div id='post-content'>
      <div id='author' class="layout horizontal">
        <profile-img id='img' letter="[[getinitials(postContent)]]" class="self-end"></profile-img>
         <div id='author-desc' class="layout vertical self-center">
              <span id="author-name">[[postContent.user.firstName]] [[postContent.user.lastName]]
            <i style="color:teal">on [[format(postContent.updatedAt)]]</i></span>
          </div>
      </div>


      <aq-help-marked-item help-text="[[postContent.markdownText]]"></aq-help-marked-item>

      <template is='dom-if' if="[[isValidBacktestId(postContent)]]">
          <aq-backtest-detail-item backtest-id="[[getBacktestId(postContent)]]">
          </aq-backtest-detail-item>
      </template>

    </div>

  </template>

  <script>
    Polymer ({
      is: 'aq-community-postdetail-content',
      properties :{
        postContent: Object,  
      },

      ready: function() {
          var x = localStorage.getItem('my-app-storage');
          var user = JSON.parse(x).user;
          if (user.token) {
            this.header = {
              "aimsquant-token": user.token,
              "Content-Type": "application/json"};  
          }
                    
      },

      getinitials: function(item) {
        return item.user.firstName[0] + item.user.lastName[0];
      },

      format: function(date) {
          return new Date(date).toLocaleTimeString("en-us", options);
      },

      isValidBacktestId: function(postContent) {
         return this.getBacktestId(postContent) ? true : false;
      },

      getBacktestId: function(postContent) {
        //Backward compatibility 
        if (postContent["backtest"]) {
          return postContent["backtest"];
        } else {
          return postContent.backtestId;
        }
      },


    });

  </script>

</dom-module>
