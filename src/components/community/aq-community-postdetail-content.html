<link rel='import' href='../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html'>
<link rel='import' href='../../../bower_components/polymer-quill/polymer-quill-html-render.html'>

<link rel="import" href="../help/aq-help-marked-item.html">
<link rel="import" href="../common/aq-backtest-detail-item.html">
<link rel="import" href="../profile-img.html">
<link rel="import" href="../common/aq-profile-pic-element.html">
<link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">
<link rel="import" href="../common/aq-label-content-item.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">

<dom-module id="aq-community-postdetail-content">

    <style include="iron-flex iron-flex-alignment iron-positioning">
    </style>

    <style>
        :host {
            display: block;
            color: #24293d;
        }

        #author {
            --margin-top: 40px;
            --margin-bottom: 15px;
            font-size: 14px;
            font-family: 'Lato', sans-serif;
            border-bottom: 1px solid #efefef;
        }

        #img {
            margin-right: 10px;
            margin-bottom: 5px;
        }

        #post-content {
            margin-bottom: 20px;
            box-shadow: var(--aq-community-postdetail-content-box-shadow, 0 0px 0px rgba(0, 0, 0, 0.2));
            padding: var(--aq-community-postdetail-content-padding, 0);
            border-radius: 4px;
            padding: 20px;
            background-color: white;
        }

        .markdown-html {
            border: 1px solid #efefef;
            --margin-left: 5px;
            padding-left: 5px;
            margin-top: 5px;
            font-size: 13px;
            min-height: 50px;
            --max-height: 350px;
            overflow: auto;
        }

        i {
            font-size: 12px;
        }

        aq-help-marked-item {
            color: #8c8c8c;
            font-size: 12px;
        }

        .tags-container {
            list-style: none;
            padding: 0;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .tags-container li {
            display: inline;
        }

        .tags-header {
            font-size: 0.8em;
            color: #727272;
            margin-right: 20px;
        }

        aq-backtest-detail-item {
            --aq-backtest-detail-item-width: 100%;
        }

        tag-element {
            margin-bottom: 10px;
        }

        aq-backtest-detail-item {
            --card-action-background-color: var(post-content-background-color, #fafafb);
        }

        polymer-quill-html-render {
          border-bottom: 1px solid #efefef;

          margin-top: 5px;
          margin-bottom: 15px;
          min-height: 100px;
          --polymer-quill-html-padding: 10px;
        }

    </style>

    <template>
        <div id='post-content'>
            <div id='author' class="layout horizontal center">
                <profile-img class="self-center" id='img' letter="[[getinitials(postContent)]]" class="self-end"></profile-img>
                
                <span class="self-center" id="author-name">by 
                  <span class="self-center author-name-detail">[[postContent.user.firstName]] [[postContent.user.lastName]]</span>
                </span>
              
                <span class="self-center created-text">&nbsp on 
                  <span class="self-center created-date">[[format(postContent.updatedAt)]]</span>
                </span>
            </div>
            
            <template is="dom-if" if="[[postContent.tags.length]]">
                <div class="tags-div layout horizontal center">
                    <span class="tags-header">Tags: &nbsp;</span>
                    <ul class="tags-container">
                        <template is="dom-repeat" items="[[postContent.tags]]">
                            <li>
                                <tag-element label="{{item}}"></tag-element>
                            </li>
                        </template>
                    </ul>
                </div>
            </template>

            <polymer-quill-html-render content="[[postContent.markdownText]]">
            </polymer-quill-html-render>

            <template is='dom-if' if="[[isValidBacktestId(postContent)]]">
                <aq-backtest-detail-item elevation="0" backtest-id="[[getBacktestId(postContent)]]">
                </aq-backtest-detail-item>
            </template>

        </div>

    </template>

    <script>

        Polymer({
            is: 'aq-community-postdetail-content',
            properties: {
                postContent: Object,
            },

            hasContent: function (item) {
                if (item) {
                    return Object.keys(item).length > 0;
                }

                return false;
            },

            getinitials: function (item) {
                if (item && item.user) {
                    return item.user.firstName[0] + item.user.lastName[0];
                } else
                    return "";
            },

            format: function (date) {
                var options = {
                    weekday: "long", year: "numeric", month: "short",
                    day: "numeric", hour: "2-digit", minute: "2-digit"
                };

                return new Date(date).toLocaleTimeString("en-us", options);
            },

            isValidBacktestId: function (postContent) {
                return this.getBacktestId(postContent) ? true : false;
            },

            getBacktestId: function (postContent) {
                if (postContent["backtest"]) {
                    return postContent["backtest"];
                } else {
                    return postContent.backtestId;
                }
            },


        });

    </script>

</dom-module>
