<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel='import' href='../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html'>
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel='import' href='../../../bower_components/paper-card/paper-card.html'>
<link rel='import' href='../profile-img.html'>
<link rel="import" href="../help/aq-help-marked-item.html">
<link rel="import" href="../../icons/aq-iconset.html">
<link rel="import" href="../common/tag-element.html">
<link rel="import" href="../common/post-user-comment.html">
<link rel="import" href="../common/label-content-item.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../common/profile-pic-element.html">
<link href="https://fonts.googleapis.com/css?family=Lato:300,400" rel="stylesheet">

<dom-module id="aq-community-home-post-item2">
    <template>
        <style>
            :host {
                display: inline-block;
                position: relative;
            }

            .container {
                display: flex;
                width: 97%;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
                flex-direction: column;
                justify-content: center;
                padding: 15px 20px 10px 20px;
                margin-bottom: 25px;
                border-radius: 2px;
                transition: all 0.2s ease-in-out;
                cursor: pointer;
                background-color: #fff;
            }

            .container:hover {
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            }

            h1, h2, h3, h4, h5 {
                margin: 0;
                padding: 0;
            }

            .tags-container {
                list-style: none;
                padding: 0;
                margin-top: 10px;
                margin-bottom: 10px;
            }

            .tags-container li {
                display: inline;
            }

            .bar {
                width: 100%;
                background-color: #E0E0E0;
                height: 1px;
                margin: 0 auto;
                margin-bottom: 10px;

            }

            .lower-container {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
            }

            .header {
                color: #5d5d5d;
                font-family: 'Lato', sans-serif;
                font-weight: 400;
                font-size: 16px;
            }

            .attachment-btn {
                color: #cc4444;
                position: absolute;
                right: 15px;
                top: 5px;
            }

            .lower-container .left-part {
                display: flex;
                flex-direction: row;
                align-items: center;
            }

            .lower-container .right-part {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .left-part post-user-comment {
                margin-right: 30px;
            }

            .post-icon {
                color: #cc4444;
                transform: scale(1.8, 1.8);
                position: relative;
                top: 10px
            }

            .upper-container {
                display: flex;
                flex-direction: row;
            }

            .upper-container-header {
                display: flex;
                flex-direction: column;
                position: relative;
                left: 15px;
            }

            label-content-item {
                margin-left: 20px;
            }

            profile-pic-element {
                margin-right: 10px;
            }
        </style>
        <div class="container" on-tap='goToDetail'>
            <div class="upper-container">
                <iron-icon class="post-icon" icon="{{icon}}"></iron-icon>
                <div class="upper-container-header">
                    <h1 class="header">[[thread.title]]</h1>
                    <ul class="tags-container">
                        <li>
                            <tag-element label="Julia"></tag-element>
                        </li>
                        <li>
                            <tag-element label="Python"></tag-element>
                        </li>
                        <li>
                            <tag-element label="C++"></tag-element>
                        </li>
                        <li>
                            <tag-element label="Java"></tag-element>
                        </li>
                        <li>
                            <tag-element label="HTML 5"></tag-element>
                        </li>
                    </ul>
                </div>
                <paper-icon-button class="attachment-btn" icon="attachment"></paper-icon-button>
            </div>
            <div class="bar"></div>
            <div class="lower-container">
                <div class="left-part">
                    <profile-pic-element></profile-pic-element>
                    <post-user-comment user="[[getAuthorFullName(thread.user.firstName, thread.user.lastName)]]" time="[[format(thread.createdAt)]]"></post-user-comment>
                    <post-user-comment label="Last Reply" user="[[getReplyAuthor(thread)]]" time="[[getReplyDate(thread)]]"></post-user-comment>
                </div>
                <div class="right-part">
                    <label-content-item label="Views" text="[[thread.views]]"></label-content-item>
                    <label-content-item label="Replies" text="[[thread.replies.length]]"></label-content-item>
                    <label-content-item label="Followers" text="[[thread.followers.length]]"></label-content-item>
                </div>
            </div>
        </div>
    </template>


    <script>
        Polymer({
            is: 'aq-community-home-post-item2',
            properties: {
                thread: {
                    type: Object
                },
                icon: {
                    type: String,
                    value: "lightbulb-outline"
                }
            },
            ready: function () {
                if (this.icon === 'communication:forum') {
                    this.$$('.post-icon').style.transform = "scale(1,1)";
                }
            },
            getInitials: function (firstName, lastName) {
                return firstName.charAt(0) + lastName.charAt(0);
            },

            goToDetail: function () {
                this.fire('rt-changed', {route: '/dashboard/community/' + this.thread._id});
            },

            getLastReplyDetails: function (thread) {

                var lastreplyAuthor = this.getReplyAuthor(thread);
                var lastreplyDate = this.getReplyDate(thread);

                if (lastreplyDate != '' && lastreplyAuthor != '') {
                    return lastreplyAuthor + " on " + lastreplyDate;
                } else {
                    return "No replies yet. Be the first one to reply!!";
                }
            },

            getAuthorFullName: function (authorFirstname, authorLastname) {
                return authorFirstname + ' ' + authorLastname;
            },

            getReplyDate: function (thread) {
                if (thread.replies.length > 0) {
                    return this.format(thread.replies[thread.replies.length - 1].createdAt);
                } else {
                    return 'No replies yet. Be the first one to reply!!';
                }
            },

            getReplyAuthor: function (thread) {
                if (thread.replies.length > 0) {
                    var reply = thread.replies[thread.replies.length - 1];
                    return reply.user.firstName + " " + reply.user.lastName;
                } else {
                    return '';
                }
            },

            hasBacktest: function (thread) {
                if (thread.backtestId) {
                    return true;
                }

                for (i = 0; i < thread.replies.length; i++) {
                    if (thread.replies[i].backtestId) {
                        return true;
                    }
                }

                return false;
            },

            format: function (date) {
                var options = {
                    weekday: "long", year: "numeric", month: "short",
                    day: "numeric", hour: "2-digit", minute: "2-digit"
                };

                return new Date(date).toLocaleTimeString("en-us", options);
            },

            hasReplies: function (thread) {
                return thread.replies && thread.replies.length > 0;
            },


        });
    </script>

</dom-module>

