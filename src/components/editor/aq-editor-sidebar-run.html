<link rel='import' href='../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html'>
<link rel='import' href='../common/aq-dropdown.html'>
<link rel="import" href="../../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../../bower_components/paper-tabs/paper-tab.html">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
<link rel="import" href="../../../bower_components/paper-date-picker/paper-date-picker.html">
<link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../common/group-selector.html">
<dom-module id='aq-editor-sidebar-run'>
    <style include="iron-flex iron-flex-alignment iron-positioning"></style>

    <style>

        :host {
            font-family: 'Lato', sans-serif;
            color: #24293d;
        }

        #advancedSettings {
            --height: 35px;
            margin-top: 5px;
            --margin-left: 5px;
            --border: 1px solid #e5e5e5;
            padding-bottom: 10px;
        }

        #universeSettings {
            padding-bottom: 10px;
        }

        #date-settings {
            --height: 80px;
            margin-top: 8px;
            --border: 1px solid #e5e5e5;
            --width: 90%;
        }

        #heading {
            margin-top: 10px;
            margin-left: 14px;
        }

        #heading span {
            font-weight: bold;
            --color: green;
            color: #24293d;
        }

        paper-button {
            top: 0;
            --margin-top: 10px;
        }

        paper-button :active {
            background-color: blue;
        }

        textarea {
            font-size: 15px;
            color: #02558b;
        }

        textarea:focus {
            border-color: #cbefde;
        }

        aq-dropdown {
            --dropdown-height: 27px;
            --dropdown-width: 140px;
            margin-top: -13px;
            --dropdown-background-color: #cbefde;
        }

        .smallInputBox {
            width: 40px !important;
            height: 21px !important;
            margin-left: 5px;
            margin-top: -1px;

        }

        .smallDropdown {
            --dropdown-width: 90px;
        }

        #run {
            color: #24293d;
            /*margin: 10px 30px;*/
        }

        vaadin-date-picker {
            width: 200px;
        }

        .input-box {
            border: 1px solid #d4d4d4;
            padding: 5px 10px;
            outline: none;
            font-size: 14px;
            width: 200px;
            /*margin-left: 20px;*/
        }

        /*.box{*/
        /*margin-left: 15px;*/
        /*}*/
        vaadin-date-picker {
            /*background-color: #00acc1;*/
            width: 150px;
            position: relative;
            font-size: 14px;

        }

        tr {
            position: relative;
            border: 4px solid;
            /*margin-bottom: 20px;*/
            /*transform: translate(0,35px);*/
        }

        #basic-settings .input-span {
            position: relative;
            top: 15px;
        }

        #input-capital {
            font-size: 14px;
        }

        #input-capital, .input-span {
            color: #7c7c7c;
            font-family: 'Lato', sans-serif;
            font-size: 14px;
        }

        paper-tabs {
            --paper-tabs-selection-bar-color: #cc4444;
            width: 300px;
        }

        paper-tab {
            float: left;
            --paper-tab-ink: #cc4444;
        }

        .paper-tabs-text {
            font-size: 12px;
        }

        iron-pages {
            margin-top: 20px;
        }

        .square-btn {
            padding: 3px 5px;
            background-color: #f2f2f2;
            border-radius: 2px;
            border: none;
            outline: none;
            color: #898989;
            margin-right: 10px;
        }

        .inputbox {
            margin-bottom: 20px;
        }
        .button-select-container{
            display: inline-block;
        }
        .advanced-settings tr{
            height: 50px;
        }
        .advanced-settings tr td{
            margin-left: 10px;
        }
        .box{
            width: 40px;
            height: 25px;
            text-align: center;
        }
        .split-bar{
            width: 2px;
            height: 40px;
            background-color: #f2f2f2;
            position: absolute;
            top:4px;
            margin-left: 53px;
        }
        td{
            position: relative;
        }
        table{
            margin-left: 15px;
        }

    </style>

    <template>
        <div id='run' class="layout vertical flex">
        	 <paper-tabs selected="{{selected}}" >
                <paper-tab><span class="paper-tabs-text">Basic</span></paper-tab>
                <paper-tab><span class="paper-tabs-text">Advanced</span></paper-tab>
              
            </paper-tabs>

            <iron-pages selected="{{selected}}">
                <div id='basic-settings' class="layout vertical">
                    <div id='date-settings' class="layout vertical">
                        <table>
                            <col width="100">
                            <col width="300">
                            <thead>
                            <tr>
                                <td style="display: none">Text</td>
                                <td style="display: none">Input Box</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>
                                    <span id="input-capital">Initial Capital</span>
                                </td>
                                <td>
                                    <input class="input-box" label="Seed Capital"
                                           value="{{initialCash::change}}" type="number"
                                           on-keydown="checkForKeys" on-blur='close'>
                                </td>
                            </tr>
                            <tr class="second-tr">
                                <td><span class="input-span">Start Date</span></td>
                                <td>
                                    <vaadin-date-picker value="{{startDate}}"></vaadin-date-picker>
                                </td>
                            </tr>
                            <tr class="second-tr">
                                <td><span class="input-span">End Date</span></td>
                                <td>
                                    <vaadin-date-picker value="{{endDate}}"></vaadin-date-picker>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
                <div id='advancedSettings' class="layout vertical">
                    <table>
                        <col width="100">
                        <col width="300">
                        <thead>
                        <tr style="display: none">
                            <td>Label</td>
                            <td>Text</td>
                        </tr>
                        </thead>
                        <tbody class="advanced-settings">
                        <tr>
                            <td><span class="input-span">Rebalance</span></td>
                            <td>
                                <div class="button-select-container layout horizontal">
                                    <group-selector event-name="rebalance-selected" items="{{rebalanceOptions}}"></group-selector>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="input-span">Cancel Policy</span></td>
                            <td>
                                <div class="button-select-container layout horizontal">
                                    <group-selector event-name="cancel-policy-selected" items="{{cancelOptions}}"></group-selector>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="input-span">Resolution</span></td>
                            <td>
                                <div class="button-select-container layout horizontal">
                                    <group-selector event-name="resolution-selected" items="{{resolutionOptions}}"></group-selector>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="input-span">Commission</span></td>
                            <td>
                                <input class="box" placeholder="Commission" class="smallInputBox"
                                       value="{{commissionValue::change}}" type="number" default
                                       on-keydown="checkForKeys" on-blur='close' step="0.01" min=0>
                                <div class="split-bar"></div>
                                <div style="display: inline-block;margin-left: 15px;" class="button-select-container layout horizontal">
                                    <group-selector event-name="commision-selected" items="{{commissionOptions}}"></group-selector>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="input-span">Slippage</span></td>
                            <td>
                                <input class="box" class="smallInputBox" placeholder="Slippage"
                                       value="{{slippageValue::change}}" type="number"
                                       on-keydown="checkForKeys" on-blur='close' step="0.01" min=0>
                                <div class="split-bar"></div>
                                <div style="display: inline-block;margin-left: 15px;" class="button-select-container layout horizontal">
                                    <group-selector event-name="slippage-selected" items="{{slippageOptions}}"></group-selector>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="input-span">Investment Plan</span></td>
                            <td>
                                <div class="button-select-container layout horizontal">
                                    <group-selector event-name="investment-plan-selected" items="{{investmentPlanOptions}}"></group-selector>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </iron-pages>
        </div>

    </template>

    <script>
        var slippageOptions = [{index: 0, value: 'Variable'},
            {index: 1, value: 'Spread'}];

        var cancelOptions = [{index: 0, value: 'EOD'},
            {index: 1, value: 'GTC'}];

        var commissionOptions = [{index: 0, value: 'PerTrade'},
            {index: 1, value: 'PerShare'}];

        var rebalanceOptions = [{index: 0, value: 'Daily'},
            {index: 1, value: 'Weekly'},
            {index: 2, value: 'Monthly'}];

        var resolutionOptions = [{index: 0, value: 'Day'}]

        var investmentPlanOptions = [{index: 0, value: 'AllIn'},
            {index: 1, value: 'Monthly'},
            {index: 2, value: 'Yearly'},
            {index: 3, value: 'Weekly'}]


        Polymer({
            is: 'aq-editor-sidebar-run',

            properties: {
                selected: {
                    type: Number,
                    value: 0
                },
                startDate: {
                    type: String,
                    value: "",
                },

                endDate: {
                    type: String,
                    value: "",
                },

                initialCash: {
                    type: Number,
                    value: 1000000,
                },

                rebalance: {
                    type: String,
                    value: rebalanceOptions[0].value,
                },

                cancelPolicy: {
                    type: String,
                    value: cancelOptions[0].value,
                },

                slippageValue: {
                    type: Number,
                    value: 0.05,
                },

                slippageModel: {
                    type: String,
                    value: slippageOptions[0].value,
                },

                commissionValue: {
                    type: Number,
                    value: 0.1,
                },

                commissionModel: {
                    type: String,
                    value: commissionOptions[0].value,
                },


                resolution: {
                    type: String,
                    value: resolutionOptions[0].value,
                },

                universe: {
                    type: String,
                    value: "",
                },

                investmentPlan: {
                    type: String,
                    value: investmentPlanOptions[0].value,
                },

                slippageOptions: Array,
                cancelOptions: Array,
                commissionOptions: Array,
                rebalanceOptions: Array,
                resolutionOptions: Array,
                investmentPlanOptions: Array,
            },

            ready: function () {
                this.slippageOptions = slippageOptions;
                this.cancelOptions = cancelOptions;
                this.commissionOptions = commissionOptions;
                this.rebalanceOptions = rebalanceOptions;
                this.resolutionOptions = resolutionOptions;
                this.investmentPlanOptions = investmentPlanOptions;
                this.startDate = this.getTodayDate(365)
                this.endDate = this.getTodayDate(7);
            },

            attached: function () {

                //this.$$('#endDateField').setAttribute("max", this.endDate);

            },

            toggle: function () {
                if (this.$.adcollapse.opened) {
                    this.$.advancedSettings.style.height = '35px';

                } else {
                    this.$.advancedSettings.style.height = '310px';
                }

                this.$.adcollapse.toggle();
            },


            getSettings: function () {
                var settings = {
                    startDate: this.startDate,
                    endDate: this.endDate,
                    initialCash: parseInt(this.initialCash),
                    advanced: JSON.stringify({
                        rebalance: this.rebalance,
                        cancelPolicy: this.cancelPolicy,
                        slippage: {model: this.slippageModel, value: this.slippageValue},
                        commission: {model: this.commissionModel, value: this.commissionValue},
                        resolution: this.resolution,
                        investmentPlan: this.investmentPlan
                    }),
                    universe: this.universe
                };
                return settings;
            },

            getTodayDate: function (offset) {
                var today = new Date();
                today.setDate(today.getDate() - offset);
                var dd = today.getDate();
                var mm = today.getMonth() + 1; //January is 0!
                var yyyy = today.getFullYear();

                if (dd < 10) {
                    dd = '0' + dd
                }

                if (mm < 10) {
                    mm = '0' + mm
                }

                today = yyyy + '-' + mm + '-' + dd;
                return today;
            },
            openDatePicker: function () {
                this.$.dialog.toggle();
            }


        });
    </script>

</dom-module>