<link rel="import" href="../../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">

<link rel='import' href="../../../bower_components/iron-scroll-spy/iron-auto-scroll-spy.html">

<link rel='import' href='../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html'>

<link rel="import" href="./aq-help-marked-item.html">

<dom-module id="aq-help-home">
  <style is="custom-style" include="iron-flex iron-flex-alignment iron-positioning"></style>
   <style>
    #panel {
      height:100%;
    }

    #mainPanel {
      margin: 0 auto;
      border-right: 1px solid;
      background-color: white;
    }
    .selectableCategories{
      cursor: pointer;
    }
    .selectableCategories:hover{
      color: green;
      font-weight: bold;
    }
    .searchCategories{
      width: 90%;
      margin-left:5%;
    }

  </style>
 
  <template>
      <style>
        #autoScrollSpy div {
          padding: 150px;
          border-bottom: 1px solid grey;
          transition: background 0.2s;
        }
      </style>

      <paper-drawer-panel id="drawerPanel" right-drawer>

          <paper-header-panel main id="mainPanel" mode="seamed">
              <iron-auto-scroll-spy scroll-duration=0 selected="{{scrollSelected}}" id="autoScrollSpy">
                <template is="dom-repeat" items="{{itemsHelpContent}}">      
                  <div> <h1>{{item.header}}</h1> <br>
                  <img src="{{item.img_src}}" height="400" width="400">
                  <p>{{item.text}}</p></div>
                </template>
              </iron-auto-scroll-spy>
          </paper-header-panel>
          <iron-ajax auto url=""
            handle-as="json"
            id="getHelpCategoryQuery"
            on-response="onGetHelpCategoriesSuccess"
            debounce-duration="300"></iron-ajax>

            <iron-ajax auto url=""
            handle-as="json"
            id="getHelpContentQuery"
            on-response="onGetHelpContentSuccess"
            debounce-duration="300"></iron-ajax>

          <paper-header-panel drawer mode="seamed">
            <paper-input class="searchCategories" label="Search Categories" on-keyup="search" id="search_input"></paper-input>
              <paper-listbox selected="{{scrollSelected}}">   
                <template is="dom-repeat" items="{{itemsCategories}}">      
                  <paper-item class="selectableCategories">{{item.Category}}</paper-item>
                </template>
              </paper-listbox>
          </paper-header-panel>


      </paper-drawer-panel>

  </template>

  <script>
    Polymer ({
      is: 'aq-help-home',

      properties:{
        itemsCategories: {
          type: Object,
          value: true,
        },
        itemsHelpContent: {
          type: Object,
          value: true,
        },
        categoriesArray:{
          type: Object,
          value: true,
        }
      },

      ready: function() {
         this.$$('#autoScrollSpy').scrollTarget = this.$.mainPanel.scroller;
         this.$.getHelpCategoryQuery.url = "http://localhost:8080/src/components/help/data_categories.json";
         this.$.getHelpContentQuery.url = "http://localhost:8080/src/components/help/data_help.json";
      },

      search: function(){
        var search = this.$$('#search_input').value;
        search = search.toLowerCase();
        var parent = this;
        var categoriesClass = document.getElementsByClassName('selectableCategories');
        // for(var i=0; i<this.itemsCategories.length;i++){
          // if(search.indexOf(parent.itemsCategories[i].Category))
        // }
        var text;
        for(var i=0; i<this.categoriesArray.length;i++){
          text = parent.categoriesArray[i].Category.toLowerCase();
          if(text.indexOf(search) > -1){
            categoriesClass[i].style.display="block";
            categoriesClass[i].style.lineHeight="3";
          }
          else{
            categoriesClass[i].style.display="none";
          }
        }
      },

      onGetHelpCategoriesSuccess: function(e){
        this.set('itemsCategories',e.detail.response.Categories);
        this.categoriesArray = this.itemsCategories;
      },
      onGetHelpContentSuccess: function(e){
        this.set('itemsHelpContent', e.detail.response.Help)
      }
    });
  </script>
</dom-module>