
<link rel='import' href='../../../bower_components/paper-icon-button/paper-icon-button.html'>
<link rel='import' href='../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html'>

<link rel='import' href='../../icons/aq-iconset.html'>
<link rel="import" href="../common/backtest/aq-forwardtest-detail-item.html">
<link rel="import" href="../common/aq-check-authentication.html">
<link rel="import" href="../common/aq-allpage-layout.html">
<link rel="import" href="../common/aq-navigation-item.html">

<dom-module id="aq-analyze-forwardtest-detail">
    
    <style  include="iron-flex iron-flex-alignment iron-positioning">
    </style>

    <style>
        #forwardtest-container {
            --margin-left: 0%;
            --margin-right: 0%;
            margin-top: 0px;
            margin-bottom: 0px;
        }

        #navigation-panel {
            margin-top: 5px;
            margin-bottom: 20px;
        }
    </style>

    <template>

        <aq-check-authentication id='authItem'></aq-check-authentication>
    
        <template is='dom-if' if='{{!loading}}'>
            <aq-allpage-layout loading='{{loading}}' no-nav>
                <div class="internal-content" id="forwardtest-container">
                    
                    <div id='navigation-panel'>
                        <aq-navigation-item id="navigation-item" 
                            header="" 
                            path="[[currentPath]]">
                        </aq-navigation-item>
                    </div>
                        
                    <aq-forwardtest-detail-item 
                        loading="{{loading}}" 
                        forwardtest-id="[[forwardtestId]]">
                    </aq-forwardtest-detail-item>
                </div>
            </aq-allpage-layout>
        </template>

         <aq-action-dialog id="stopForwardTestDialog" 
            heading="Stop Forward Test" 
            message="Are you sure to stop this forward test?" 
            action-type="stoptest" 
            cancel="Cancel"
            accept="Stop">
        </aq-action-dialog>  

    </template>

    <script>
        Polymer ({
            is:'aq-analyze-forwardtest-detail',
            
            properties:{
                strategyId:String,
                forwardtestId:String,

                loading:{
                    type:Boolean,
                    value:false,
                },

                currentPath: {
                    type: Array,
                    value: ["Home", "Research", "All Strategies","Forward Test Detail"]
                }
            },

            listeners: {
               'stoptest-clicked':'onStopForwardTestDialog', 
               'stoptest-action':'onStopForwardTestAction',
            },

            computeUpdateForwardtestUrl: function(forwardtestId) {
                return /forwardtest/+forwardtestId;
            },

            onStopForwardTestDialog: function(e) {
                e.stopPropagation();
                this.$.stopForwardTestDialog.open();
            },

            onStopForwardTestAction: function(e) {
                e.detail.forwardtestIds = [this.forwardtestId];
            },

            onDeleteTest: function(e) {
                this.forwardtestId = e.detail.id;

                if(this.forwardtestId && this.forwardtestId!="" && this.$.authItem.checkHasToken()) {
                    this.testUpdateData = {deleted: true};

                    this.header = this.$.authItem.getHeader();
                    this.$.updateForwardtestQuery.generateRequest();
                }
            },

            goBackAllBacktests: function() {
                this.fire('unsubscribe-data',{backtestId:this.backtestId});
                this.fire('rt-changed',{route:'/dashboard/analyze/' + this.strategyId});
            },

            attached: function() {
                if(!this.$.authItem.checkHasToken()) {
                    this.fire('rt-changed',{route:'/user/signin'});
                    return;
                } 
            },

        });
            
    </script>
            
</dom-module>


