<link rel='import' href='../../bower_components/iron-flex-layout/iron-flex-layout-classes.html'>
<link rel='import' href='../../bower_components/app-route/app-route.html'>

<link rel="import" href="../../bower_components/iron-lazy-pages/iron-lazy-pages.html">
<link rel="import" href="../../bower_components/iron-lazy-pages/iron-lazy-page.html">

<link rel="import" href="../components/analyze/aq-analyze-home.html">

<link rel="import" href="../components/analyze/aq-analyze-backtest-detail.html">
<link rel="import" href="../components/analyze/aq-analyze-forwardtest-detail.html">
<link rel="import" href="../components/analyze/aq-analyze-detail.html">


<dom-module id="aq-analyze-main">
    <style include="iron-flex iron-flex-alignment iron-positioning">
    </style>
    <style>
        #panel {
            height: 100%;
        }
    </style>
    <template>

        <app-location route="{{route}}" use-hash-as-path></app-location>
        
        <app-route
            route="{{route}}"
            pattern="/dashboard/analyze/:strategyId"
            data="{{homeData}}">
        </app-route>

        <app-route
            route="{{route}}"
            pattern="/dashboard/analyze/:strategyId/:id"
            data="{{detailData}}"
            query-params="{{queryParams}}"
            active="{{detailActive}}">
        </app-route>

        <!--RESTAMPING HERE SO THAT CHILD IS FRESHLY ADDED EVERYTIME
        DONE THIS TO PREVENT UNEXPECTED BEHAVIOR DOWNSTREAM WHERE CHILD WAS GETTING ATTACHED TWICE-->
        <iron-lazy-pages restamp attr-for-selected="page" selected="[[_computeAnalyzePage(detailActive)]]">
            <template is="iron-lazy-page" page="home">
                <aq-analyze-home strategy-id='[[homeData.strategyId]]'></aq-analyze-home>
            </template>

            <template is="iron-lazy-page" page="detail">
                <aq-analyze-detail
                    type-id='[[detailData.id]]'
                    strategy-id='[[detailData.strategyId]]' 
                    params="[[queryParams]]">
                </aq-analyze-detail>
            </template>

            <!--template is="iron-lazy-page" page="detail">
                <iron-lazy-pages attr-for-selected="page" selected="[[_computeDetailPage(queryParams)]]">
      
                    

                    <template is="iron-lazy-page" page="detail-forwardtest">
                        <aq-analyze-forwardtest-detail 
                            forwardtest-id='[[detailData.id]]'
                            strategy-id='[[detailData.strategyId]]'>
                        </aq-analyze-forwardtest-detail>
                    </template>
                </iron-lazy-pages>
            </template-->
        </iron-lazy-pages>
    </template>

    <script>
        Polymer({
            is: 'aq-analyze-main',

            properties: {
                detailActive: Boolean,
                queryParams: Object,
            },

            _computeAnalyzePage: function(detailActive) {
               return detailActive ? "detail" : "home";
            },

        });
    </script>
</dom-module>
